---
layout: post
title: "接码流程协议文档"
date: 2019-04-08 20:13:37 +0800
categories: SMS
tags: document
author: ougato
mathjax: true
---

* content
{:toc}




# API协议

![时序图](https://raw.githubusercontent.com/ougato/ougato.github.res/master/2019-04-08-SMSDoc/SMS_UML.png)

![流程图](https://raw.githubusercontent.com/ougato/ougato.github.res/master/2019-04-08-SMSDoc/SMSFlowChart.png)

## HTTP

### 请求信息
* 地址：`http://39.108.178.40`
* 端口：8080

### 注册账号

* 请求类型：
    + `POST`
* 链接地址：
    + `http://39.108.178.40:8080/signup`
* 请求参数：
    + `user` **用户名**
    + `password` **密码**
* 响应参数：
    + `code` **返回码**
        - `0` *成功*
        - `-1` *用户名长度错误*
        - `-2` *用户名为空*
        - `-3` *用户名敏感字符*
        - `-4` *密码长度错误*
        - `-5` *密码为空*
        - `-6` *密码敏感字符*
    + `token` **校验码**

### 换取token

* 请求类型：
    + `POST`
* 链接地址：
    + `http://39.108.178.40:8080/login`
* 请求参数：
    + `user` **用户名**
    + `password` **密码**
* 响应参数：
    + `code` **返回码**
        - `0` *成功*
        - `-1` *用户名不存在*
        - `-2` *用户名为空*
        - `-3` *密码为空*
        - `-4` *密码错误*
    + `token` **校验码**

### 获取验证码（找回密码）

* 请求类型：
    + `POST`
* 链接地址：
    + `http://www.xxx.com:xxx/xxx.xx?user=xxx&email=xxx@xx.xxx`
* 请求参数：
    + `user` **用户名**
    + `email` **邮箱**
* 响应参数：
    + `code` **返回码**
        - `0` *成功*
        - `-1` *用户名不存在*
        - `-2` *用户名为空*
        - `-3` *邮箱不存在*
        - `-4` *邮箱为空*
        - `-5` *用户名对应邮箱不匹配*
    + `againTimestamp` **时间戳** *再次获取验证码*

### 校验验证码（找回密码）

* 请求类型：
    + `POST`
* 链接地址：
    + `http://www.xxx.com:xxx/xxx.xx?user=xxx&email=xxx@xx.xxx&verify=xxxxxx`
* 请求参数：
    + `user` **用户名**
    + `email` **邮箱**
    + `verify` **验证码**
* 响应参数：
    + `code` **返回码**
        - `0` *成功*
        - `-1` *用户名不存在*
        - `-2` *用户名为空*
        - `-3` *邮箱不存在*
        - `-4` *邮箱为空*
        - `-5` *用户名对应邮箱不匹配*
        - `-6` *验证码错误*
    + `token` **校验码**

## Websocket `JSON`

### 连接信息
* 地址：`ws://xxx.xxx.xxx`
* 端口：xxxx

### 登录（请求 / 响应）

* 协议名：
    + `CSLogin` **客户端**
    + `SCLogin` **服务器**
* 请求参数：
    + `token` **校验码**
    + `gps` **地理位置**
* 返回参数：
    + `code` **返回码**
        - `0` *成功*
        - `-1` *token过期*
    + `data` **登陆数据**
        - `userInfo` *用户信息*
            - `user` *用户名*
            - `email` *邮箱*
            - `point` *积分*
            - `balance` *余额*
        - `flag` *标识* **（正常登陆 / token过期后登陆 / 注册后登陆  / 修改密码后登陆）**

### 登出（请求 / 响应）

* 协议名：
    + `CSLogout` **客户端**
    + `SCLogout` **服务器**
* 请求参数：

* 返回参数：
    + `code` **返回码**
        - `0` *成功*

### 修改密码（请求 / 响应）

* 协议名：
    + `CSModifyPwd` **客户端**
    + `SCModifyPwd` **服务器**
* 请求参数：
    + `token` **校验码**
    + `password` **更改后的密码**
* 返回参数：
    + `code` **返回码**
        - `0` *成功*
        - `-1` *token过期*
        - `-2` *密码长度错误*
        - `-3` *密码为空*
        - `-4` *密码敏感字符*
    + `token` **新校验码**

### 踢出（推送）

* 协议名：
    + `PushKickout` **服务器**
* 返回参数：
    + `state` **返回码**
        - `1` *服务器停机维护*
        - `2` *修改密码完成*
        - `3` *账号封停*
    + `token` **新校验码**

### 获取手机号（请求 / 响应）

* 协议名：
    + `CSMobileNum` **客户端**
    + `SCMobileNum` **服务器**
* 请求参数：
    + `itemId` **项目ID**
    + `count` **数量**
    + `area` **地区**
    + `operator` **运营商**
    + `customNum` **指定号码**
* 返回参数：
    + `code` **返回码**
        - `0` *成功*
        - `-1` *项目ID不存在*
        - `-2` *数量格式错误*
        - `-3` *地区格式错误*
        - `-4` *运营商不存在*
        - `-5` *指定号码不存在*
        - `-6` *余额不足*

### 获取手机号（推送）

* 协议名：
    + `PushMobileNum` **服务器**
* 返回参数：
    + `mobileNum` **手机号码**
    + `useTimestamp` **使用截止时间戳**

### 短信接收（推送）

* 协议名：
    + `PushRecvMsg` **服务器**
* 返回参数：
    + `mobileNum` **手机号码**
    + `msg` **短信内容**

### 发送短信（请求 / 响应）

* 协议名：
    + `CSSendMsg` **客户端**
    + `SCSendMsg` **服务器**
* 请求参数：
    + `itemId` **项目ID**
    + `mobileNum` **手机号码**
    + `msg` **短信内容**
* 返回参数：
    + `code` **返回码**
        - `0` *成功*
        - `-1` *项目ID不存在*
        - `-2` *手机号码错误*
        - `-3` *短信内容过长*
        - `-4` *短信为空*
        - `-5` *余额不足*

### 绑定邮箱（请求 / 响应）[获取验证码]

* 协议名：
    + `CSBindEmailGetVCode` **客户端**
    + `SCBindEmailGetVCode` **服务器**
* 请求参数：
    + `email` **邮箱**
* 返回参数：
    + `code` **返回码**
        - `0` *成功*
        - `-1` *邮箱格式错误*
    + `againTimestamp` **时间戳** *再次获取验证码*

### 绑定邮箱（请求 / 响应）[校验验证码]

* 协议名：
    + `CSBindEmailCheckVCode` **客户端**
    + `SCBindEmailCheckVCode` **服务器**
* 请求参数：
    + `email` **邮箱**
    + `vCode` **验证码**
* 返回参数：
    + `code` **返回码**
        - `0` *成功*
        - `-1` *邮箱格式错误*
        - `-2` *验证码错误*